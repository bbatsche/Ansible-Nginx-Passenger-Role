---
- hosts: all
  remote_user: vagrant
  become: yes

  vars:
    console_user: vagrant

  roles:
    - bbatsche.Base

  tasks:
    - name: Install NFS Packages
      apt: name={{ item }}
      with_items:
        - rpcbind
        - nfs-kernel-server
      notify: Restart NFS

    - name: Create NFS Export Directory
      file: path=/exports/http state=directory mode=0777
      notify: Restart NFS

    - name: Create NFS Export Record
      lineinfile:
        dest: /etc/exports
        line: /exports/http 127.0.0.1(rw,sync,no_subtree_check)
        create: yes
      notify:
        - Reload NFS Exports
        - Remount NFS

  handlers:
    - name: Restart NFS
      service: name=nfs-kernel-server state=restarted

    - name: Reload NFS Exports
      command: exportfs -ra

    - name: Remount NFS
      mount: name=/srv/http-nfs fstype=nfs src=127.0.0.1:/exports/http state=mounted
